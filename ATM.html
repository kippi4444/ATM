<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title></title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="atms">
    </div>
    <div class="people">
      
    </div>

<script type="text/javascript">

let atms = document.getElementsByClassName('atms')[0];
let people = document.getElementsByClassName('people')[0];
let mans = [];
let atmBody = [];

class ATM {

    constructor (container) {
      
      this.block = container;

      this.atmDom = document.createElement('div');
      this.atmDom.className = 'atm';
      this.block.appendChild(this.atmDom); 
      this.btn = document.createElement('button');
      this.btn.innerHTML = 'del';
      this.atmDom.appendChild(this.btn); 

      this.isFree = false;
      this.atmDelay = Math.floor(Math.random() * (1000 - 500 + 1)) + 500;
    }


    process(delay){
      this.atmDom.classList.add('free');
      this.isFree = true;
      setTimeout(() => { 
        console.log('process');
        this.isFree = false;
        this.atmDom.classList.remove('free');
      }, delay+this.atmDelay);
      console.log(delay+this.atmDelay);
    }

};

class Man {
  constructor (container){
    this.block = container;
    this.manDelay = Math.floor(Math.random() * (3000 - 1000 + 1)) + 1000;
  }

  createView(){
      this.manDom = document.createElement('div');
      this.manDom.className = 'mans';
      this.block.appendChild(this.manDom);  
    }
};


//=======================ATM==========================// 


function createATM () {
  if (atmBody.length <= 2){
    atmBody.push(new ATM(atms));
    createATM ();
  }
}



//=======================MAN==========================// 
function createMan () {
  let count = 7;

    if (mans.length <= count){
      mans.push(new Man(people));
      createMan (); 
      }


}

function viewMan(){
  people.innerHTML='';
  mans.forEach((man) => {
    man.createView();
  })
}

//=======================Move==========================// 

function move(){
  atmBody.forEach((atm) => {
    let man = mans.shift(0);
    
    if (mans.length !== 0){
      if (!atm.isFree) {
        viewMan();
        atm.process(man.manDelay);
      }
    } else {
      createMan ();
      setTimeout(move ,  1000);
    }
  });

}

//=======================init==========================// 
function init(){
  createATM();
  createMan();
  move();
}

init();

</script>
    </main>
  </body>
</html>